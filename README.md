# Сервер для проекта Mesto

_v2.0.2_

## Инструменты: 
- Node.js, 
- express.js
- REST API
- mongoose

**_Описание:_** создан сервер для проекта "Mesto"

**_В проекте реализовано:_**
- в .eslintrc добавлено исключение для _id;
- Node.js приложение подключается к серверу Mongo по адресу mongodb://localhost:27017/mestodb;
- созданы схема и модель пользователя с полями name, about и avatar, поля корректно валидируются;
- созданы схема и модель карточки с полями name, link, owner, likes и createdAt, поля корректно валидируются;
- запрос на GET /users возвращает всех пользователей из базы;
- запрос GET /users/:id возвращает конкретного пользователя;
- запрос POST /users создаёт пользователя;
- запрос PATCH /users/:id изменяет данные пользователя;
- запрос PATCH /users/:id/avatar изменяет аватар пользователя;
- запрос GET /cards возвращает все карточки всех пользователей;
- запрос POST /cards создаёт карточку;
- запрос DELETE /cards/:id удаляет карточку;
- запрос PUT /cards/:id/likes добавляет like карточке;
- запрос DELETE /cards/:id/likes удаляет like карточке;
- если в любом из запросов что-то идёт не так, сервер возвращает ответ с ошибкой и соответствующим ей статусом;

**_Что нового реализовано:_**
- в схеме пользователя есть обязательные email и password;
- поле email уникально и валидируется;
- в контроллере createUser почта и хеш пароля записываются в базу;
- есть контроллер login, он проверяет, полученные в теле запроса почту и пароль;
- если почта и пароль верные, контроллер login создаёт JWT, в пейлоуд которого записано свойство _id с идентификатором пользователя; 
- срок жизни токена — 7 дней;
- если почта и пароль верные, контроллер login возвращает созданный токен в ответе;
- если почта и пароль не верные, контроллер login возвращает ошибку 401;
- в app.js есть обработчики POST-запросов на роуты /signin и /signup;
- есть файл middlewares/auth.js, в нём мидлвэр для проверки JWT;
- при правильном JWT авторизационный мидлвэр добавляет в объект запроса пейлоуд и пропускает запрос дальше;
- при неправильном JWT авторизационный мидвэр возвращает ошибку 401;
- все роуты, кроме /signin и /signup, защищены авторизацией;
- удалён хардкод req.user;
- пользователь не может удалить карточку, которую он не создавал;
- API не возвращает хеш пароля;
- пользователь не может редактировать чужой профиль и не может менять чужой аватар.

# Как развернуть проект

Должны быть установлены node.js и npm

Скопируйте проект на компьютер:

```
git clone https://github.com/Manhetn/backend-mesto.git
```

Установите зависимости:

```
npm init
```

## Для локальной разработки с поднятием сервера используйте:

_Запуск сервера:_ 
```
npm run start 
```
_Запуск сервера с хот релоудом:_ 
```
npm run dev
```
