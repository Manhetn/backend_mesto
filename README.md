# Сервер для проекта Mesto

_v3.0.1_

## Инструменты: 
- Node.js, 
- express
- mongoose
- celebrate, joi
- Mongodb

**_Описание:_** создан сервер для проекта "Mesto"

**_Что нового реализовано:_**

- все ошибки обрабатываются централизованно;
- тела запросов и, где необходимо, заголовки и параметры, валидируются по определённым схемам. Если запрос не соответствует схеме, обработка не передаётся контроллеру и клиент получает ошибку валидации;
- все запросы и ответы записываются в файл request.log;
- все ошибки записываются в файл error.log;
- файлы логов не добавляются в репозиторий;
- к серверу можно обратиться по публичному IP-адресу https://www.api.happymestoapi.tk/;
- к фронтенду Mesto можно обратиться по адресу https://www.happymestoapi.tk/;
- к серверу и фронтенду можно обратиться по http и по https;
- секретный ключ для создания и верификации JWT хранится на сервере в .env файле. Этот файл не добавляется в git;
- в режиме разработки (когда process.env.NODE_ENV !== 'production') код запускается и работает без наличия .env файла;
- сервер самостоятельно восстанавливается после GET-запроса на URL /crash-test.

**_Что реализовано ранее:_**

- в .eslintrc добавлено исключение для _id;
- Node.js приложение подключается к серверу Mongo по адресу mongodb://localhost:27017/mestodb;
- созданы схема и модель пользователя с полями name, about и avatar, поля корректно валидируются;
- созданы схема и модель карточки с полями name, link, owner, likes и createdAt, поля корректно валидируются;
- запрос на GET /users возвращает всех пользователей из базы;
- запрос GET /users/:id возвращает конкретного пользователя;
- запрос POST /users создаёт пользователя;
- запрос PATCH /users/:id изменяет данные пользователя;
- запрос PATCH /users/:id/avatar изменяет аватар пользователя;
- запрос GET /cards возвращает все карточки всех пользователей;
- запрос POST /cards создаёт карточку;
- запрос DELETE /cards/:id удаляет карточку;
- запрос PUT /cards/:id/likes добавляет like карточке;
- запрос DELETE /cards/:id/likes удаляет like карточке;
- если в любом из запросов что-то идёт не так, сервер возвращает ответ с ошибкой и соответствующим ей статусом;
- в схеме пользователя есть обязательные email и password;
- поле email уникально и валидируется;
- в контроллере createUser почта и хеш пароля записываются в базу;
- есть контроллер login, он проверяет, полученные в теле запроса почту и пароль;
- если почта и пароль верные, контроллер login создаёт JWT, в пейлоуд которого записано свойство _id с идентификатором пользователя; 
- срок жизни токена — 7 дней;
- если почта и пароль верные, контроллер login возвращает созданный токен в ответе;
- если почта и пароль не верные, контроллер login возвращает ошибку 401;
- в app.js есть обработчики POST-запросов на роуты /signin и /signup;
- есть файл middlewares/auth.js, в нём мидлвэр для проверки JWT;
- при правильном JWT авторизационный мидлвэр добавляет в объект запроса пейлоуд и пропускает запрос дальше;
- при неправильном JWT авторизационный мидвэр возвращает ошибку 401;
- все роуты, кроме /signin и /signup, защищены авторизацией;
- удалён хардкод req.user;
- пользователь не может удалить карточку, которую он не создавал;
- API не возвращает хеш пароля;
- пользователь не может редактировать чужой профиль и не может менять чужой аватар.

# Как развернуть проект

Должны быть установлены node.js и npm

Скопируйте проект на компьютер:

```
git clone https://github.com/Manhetn/backend-mesto.git
```

Установите зависимости:

```
npm install
```

## Для локальной разработки с поднятием сервера используйте:

_Запуск сервера:_ 
```
npm run start 
```
_Запуск сервера с хот релоудом:_ 
```
npm run dev
```
